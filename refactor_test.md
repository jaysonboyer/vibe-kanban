# Refactor Lint Triage (no-restricted-imports)

Use this file to evaluate one ESLint architecture violation at a time and
choose a consistent refactor action.

## Scope

This checklist is for layer-boundary violations in `packages/local-web`, especially:

- `features -> app`
- `features -> features`
- `shared -> features`

## How To Use (Single Issue Workflow)

Run this workflow against exactly one ESLint error.

1. Paste the issue details into one row in the tracking table.
2. Run the decision tree for that issue only.
3. Pick exactly one primary action (`A1`-`A5`).
4. Add follow-up tasks if needed.
5. Implement and validate before moving to the next issue.

## Decision Tree

1. Is the imported module pure/generic and reusable across domains?
- Yes: move it to `shared` (or import from existing `shared` module).
- No: continue.

2. Is it app wiring/runtime orchestration (providers, router, bootstrapping)?
- Yes: keep in `app`; inject data/handlers into feature from app-level composition.
- No: continue.

3. Is it domain-specific state/model used by multiple feature slices?
- Yes: extract stable domain contract to `shared` (types/selectors/helpers),
  keep feature-specific adapters inside each feature.
- No: continue.

4. Is `shared` importing from `features`?
- Yes: move the imported code/type down into `shared` (or split out a shared
  contract); `shared` must not depend on higher layers.
- No: continue.

5. Is the import only needed because of convenience/re-export path?
- Yes: switch import to the proper owning layer path.
- No: continue.

6. If none fit, dependency direction is likely wrong:
- Move caller upward (to app/page) or split module responsibilities.

## Action Matrix

### A1: Repoint To Existing Lower Layer

Use when a valid `shared`/`integrations` module already exists.

- Change import path only.
- No module move needed.

### A2: Move Module Down To Shared

Use when module is cross-cutting and not feature-specific.

- Move file to `src/shared/...`
- Update imports.
- Keep naming neutral (no feature terminology in shared APIs).

### A3: Split Contract From Implementation

Use when feature implementation is specific but types/helpers are reusable.

- Extract `type` / pure helper to `shared`.
- Keep feature runtime logic in feature.

### A4: Dependency Inversion (App Injection)

Use for `features -> app` violations.

- Keep provider/hooks in `app`.
- Pass required data/functions from app to feature (props/context/adapter).

### A5: Move Caller Instead Of Dependency

Use when the caller is in the wrong layer.

- Move caller to app/page or correct feature slice.
- Leave dependency where it belongs.

## Do Not

- Do not disable `no-restricted-imports` to bypass structure issues.
- Do not move domain-specific behavior into `shared` just to satisfy lint.
- Do not add new cross-feature imports as "temporary" fixes.

## Quick Heuristics

- If 3+ feature areas import it, it likely belongs in `shared`.
- If it touches routing/providers/global bootstrap, it likely belongs in `app`.
- If it encodes one domain workflow, keep it in that feature.

## Single-Issue Tracking Row

| Status | File | Line | Importer Layer | Imported Module | Violation Type | Decision (A1-A5) | Action Summary | Owner | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| DONE | `src/features/command-bar/ui/actions/useActionVisibility.ts` | `8` | feature | `@/features/workspace-chat/model/store/useDiffViewStore` | `features -> features` | A2 | Moved `useDiffViewStore` to `src/shared/stores` and repointed imports | codex | First lint violation from current run |
| DONE | `src/features/command-bar/ui/actions/useActionVisibility.ts` | `13` | feature | `@/app/providers/ConfigProvider` | `features -> app` | A3 | Split `useUserSystem` hook + context types to `src/shared/hooks/useUserSystem.ts`, kept provider in `app`, repointed all 30 consumers | claude | Cross-cutting config access used by 31 files; eliminated 8 lint errors |
| DONE | `src/features/command-bar/ui/actions/useActionVisibility.ts` | `14` | feature | `@/features/workspace/model/hooks/useDevServer` | `features -> features` | A1 | Repointed import to `@/hooks` barrel re-export (already existed in `hooks/index.ts`) | claude | Import path change only; no module move needed |
| DONE | `src/components/NormalizedConversation/DisplayConversationEntry.tsx` | `14` | legacy (components) | `@/features/workspace-chat/model/store/useExpandableStore` | `legacy -> features` | A2 | Moved `useExpandableStore` to `src/shared/stores/useExpandableStore.ts`, deleted old file, repointed 3 consumers | claude | Pure generic zustand store with zero domain logic |
| DONE | `src/components/NormalizedConversation/DisplayConversationEntry.tsx` | `36` | legacy (components) | `@/features/workspace-chat/model/contexts/RetryUiContext` | `legacy -> features` | A3 | Split `useRetryUi` hook + context + types to `src/shared/hooks/useRetryUi.ts`, kept provider in features, repointed 3 consumers | claude | Provider depends on ExecutionProcessesContext (feature), but hook/types are pure |
| DONE | `src/components/NormalizedConversation/DisplayConversationEntry.tsx` | `42` | legacy (components) | `@/features/workspace/model/hooks/useAttemptRepo` | `legacy -> features` | A2 | Moved `useAttemptRepo` to `src/shared/hooks/useAttemptRepo.ts`, deleted old file, repointed 6 consumers | claude | No feature deps; only uses @/lib/api + shared/types |
| DONE | `src/components/NormalizedConversation/EditDiffRenderer.tsx` | `12` | legacy (components) | `@/app/styles/diff-style-overrides.css` | `legacy -> app` | A1 | Repointed 3 files from `@/app/styles/` to existing `@/styles/` proxies; also fixed `edit-diff-overrides.css` | claude | CSS-only; `@/styles/` proxies already existed; 5 violations fixed |
| DONE | `src/components/NormalizedConversation/PendingApprovalEntry.tsx` | `25` | legacy (components) | `@/features/workspace-chat/model/contexts/ApprovalFormContext` | `legacy -> features` | A2 | Moved `ApprovalFormContext` to `src/shared/hooks/ApprovalForm.tsx`, left re-export shim in features, repointed 2 consumers | claude | Pure form state context; no feature deps |
| DONE | `src/components/NormalizedConversation/RetryEditorInline.tsx` | `11` | legacy (components) | `@/features/workspace-chat/model/hooks/useAttemptExecution` | `legacy -> features` | A3 | Split `useExecutionProcessesContext` hook+context+types to `shared/hooks/useExecutionProcessesContext.ts`, moved `useTaskDetailsUiStore` to `shared/stores/`, moved `useAttemptExecution` to `shared/hooks/`, repointed 7+4 consumers | claude | Required cascading A3+A2: useAttemptExecution depended on 2 feature modules (ExecutionProcessesContext, useTaskDetailsUiStore) which both needed extraction first |
| DONE | `src/components/NormalizedConversation/RetryEditorInline.tsx` | `13` | legacy (components) | `@/features/workspace/model/hooks/useBranchStatus` | `legacy -> features` | A2 | Moved `useBranchStatus` to `src/shared/hooks/useBranchStatus.ts`, deleted old file, repointed 8 consumers | claude | Pure react-query hook; only depends on @/lib/api (shared-level); 5 violations eliminated |
| DONE | `src/components/NormalizedConversation/RetryEditorInline.tsx` | `15` | legacy (components) | `@/features/workspace-chat/model/hooks/useRetryProcess` | `legacy -> features` | A2 | Moved `useRetryProcess` to `src/shared/hooks/useRetryProcess.ts`, deleted old file, repointed 2 consumers | claude | All deps shared-level (@/lib/api, @/dialogs, shared/types); 2 violations eliminated |
| DONE | `src/components/agents/AgentIcon.tsx` | `2` | legacy (components) | `@/app/providers/ThemeProvider` | `legacy -> app` | A3 | Split `useTheme` hook + `getResolvedTheme` + context to `src/shared/hooks/useTheme.ts`, kept `ThemeProvider` in app, repointed 13 consumers | claude | Same pattern as useUserSystem; cross-cutting theme access used by 14 files; 6 violations eliminated |
| DONE | `src/components/tasks/TaskDetails/ProcessesTab.tsx` | `14` | legacy (components) | `@/features/workspace-chat/model/hooks/useExecutionProcesses` | `legacy -> features` | A2 | Moved `useExecutionProcesses` to `src/shared/hooks/useExecutionProcesses.ts`, deleted old file, repointed 6 consumers | claude | Pure WS streaming hook; only depends on @/hooks/useJsonPatchWsStream + shared/types; 2 violations eliminated |
| DONE | `src/components/tasks/TaskDetails/ProcessesTab.tsx` | `19` | legacy (components) | `@/features/workspace-chat/model/contexts/ProcessSelectionContext` | `legacy -> features` | A2 | Moved `ProcessSelectionContext.tsx` to `src/shared/hooks/ProcessSelectionContext.tsx`, deleted old file, repointed 2 consumers | claude | Pure string state context; zero domain logic, zero feature deps; 1 violation eliminated |
| DONE | `src/components/ui/wysiwyg.tsx` | `76` | legacy (components) | `@/features/command-bar/ui/actions/pages` | `legacy -> features` | A3 | Extracted `RepoItem`, `StatusItem`, `PriorityItem`, `BranchItem` types to `src/shared/types/selectionItems.ts`, updated `pages.ts` to re-export, repointed 2 component consumers | claude | Only types crossed the boundary; pages.ts re-exports for backward compat; 1 violation eliminated |
| DONE | `src/contexts/ActionsContext.tsx` | `23` | legacy (contexts) | `@/features/command-bar/ui/actions/useActionVisibility` | `legacy -> features` | A3 | Moved 6 pure action helpers (`isActionVisible`, `isActionActive`, `isActionEnabled`, `getActionIcon`, `getActionTooltip`, `getActionLabel`) to `@/components/ui-new/actions/index.ts`, kept `isPageVisible` + `useActionVisibilityContext` in features, repointed 5 consumers | claude | Helpers are pure functions on ActionDefinition+ActionVisibilityContext types already in shared; `isPageVisible` stays (depends on feature-level CommandBarPage type); 1 violation eliminated |
| DONE | `src/contexts/ActionsContext.tsx` | `26` | legacy (contexts) | `@/features/workspace/model/hooks/useDevServer` | `legacy -> features` | A2 | Moved `useDevServer` to `src/shared/hooks/useDevServer.ts`, extracted `workspaceSummaryKeys` to `src/shared/hooks/workspaceSummaryKeys.ts`, deleted old file, repointed 9 consumers across contexts/hooks/features/components | claude | Pure mutation hook; all deps shared-level once query keys extracted; `workspaceSummaryKeys` was also cross-layer imported by 6 other files; 3 violations eliminated |
| DONE | `src/contexts/CreateModeContext.tsx` | `4` | legacy (contexts) | `@/features/workspace/model/hooks/useCreateModeState` | `legacy -> features` | A2 | Moved `useCreateModeState` and `useWorkspaceCreateDefaults` to `src/shared/hooks/`, deleted old files, repointed 3 consumers | claude | Both hooks pure/generic; only feature dep was `useWorkspaceCreateDefaults` (also pure, moved together); 1 violation eliminated |
| DONE | `src/contexts/CreateModeContext.tsx` | `8` | legacy (contexts) | `@/features/workspace/model/hooks/useWorkspaces` | `legacy -> features` | A2 | Moved `useWorkspaces` to `src/shared/hooks/useWorkspaces.ts`, deleted old file, repointed 4 consumers | claude | Pure WS streaming + react-query hook; all deps shared-level; 2 violations eliminated |
| DONE | `src/contexts/WorkspaceContext.tsx` | `10` | legacy (contexts) | `@/features/workspace/model/hooks/useAttempt` | `legacy -> features` | A2 | Moved `useAttempt` to `src/shared/hooks/useAttempt.ts`, deleted old file, repointed 6 consumers | claude | Pure react-query hook; zero feature deps; 2 violations eliminated |
| DONE | `src/contexts/WorkspaceContext.tsx` | `12` | legacy (contexts) | `@/features/workspace/model/hooks/useWorkspaceSessions` | `legacy -> features` | A2 | Moved `useWorkspaceSessions` to `src/shared/hooks/useWorkspaceSessions.ts`, deleted old file, repointed 2 consumers | claude | Pure react-query + state hook; zero feature deps; 1 violation eliminated |
| DONE | `src/features/workspace-chat/ui/SessionChatBoxContainer.tsx` | `22,49` | features (workspace-chat) | `@/features/workspace-chat/model/hooks/useTodos`, `@/features/workspace-chat/model/store/useInspectModeStore` | `features -> features (intra)` | A1 | Changed absolute `@/features/` imports to relative `../model/` paths | claude | Intra-feature imports; ESLint bans absolute `@/features/` paths within features; 2 violations eliminated |
| DONE | `src/features/workspace-chat/ui/SessionChatBoxContainer.tsx` | `59` | features (workspace-chat) | `@/features/command-bar/ui/actions/useActionVisibility` | `features -> features` | A3 | Extracted `useActionVisibilityContext` hook to `src/hooks/useActionVisibilityContext.ts`, slimmed `useActionVisibility.ts` to only `isPageVisible`, repointed 4 consumers | claude | Hook depends on `@/integrations/electric/hooks` so placed in legacy `hooks/` (not `shared/`) since shared can't import integrations; `isPageVisible` stays in features (depends on feature-level `CommandBarPage` type); 2 violations eliminated |
| DONE | `src/features/workspace/model/hooks/useChangeTargetBranch.ts` | `7` | features (workspace) | `@/features/workspace/model/hooks/useRepoBranches` | `features -> features (intra, absolute)` | A2 | Moved `useRepoBranches` to `src/shared/hooks/useRepoBranches.ts`, deleted old file, repointed 9 consumers (4 intra-feature + 3 cross-layer + 2 barrel), removed re-export from `hooks/index.ts` | claude | Pure react-query hook; zero feature deps; imported by 5 layers (features, components, dialogs, hooks barrel); 5 violations eliminated |
| DONE | `src/features/workspace/model/hooks/useProjectWorkspaceCreateDraft.ts` | `3` | features (workspace) | `@/features/kanban/model/hooks/useKanbanNavigation` | `features -> features` | A2 | Moved `useKanbanNavigation` to `src/shared/hooks/useKanbanNavigation.ts`, deleted old file, repointed 8 consumers (1 cross-feature + 5 components + 2 intra-kanban) | claude | Pure navigation hook; deps are router + shared route utils; imported by 3 layers; 1 violation eliminated |
| DONE | `src/features/workspace/ui/VSCodeWorkspacePage.tsx` | `11,16,17,18` | features (workspace) | `SessionChatBoxContainer`, `EntriesContext`, `MessageEditContext`, `RetryUiContext` from `@/features/workspace-chat` | `features -> features` | A5 | Moved `VSCodeWorkspacePage.tsx` from `features/workspace/ui/` to `pages/workspaces/`, updated route import | claude | Page-level composition component that orchestrates workspace-chat providers; belongs in pages layer not features; 5 violations eliminated |
| DONE | `src/features/workspace/ui/WorkspacesLayout.tsx` | `7` | features (workspace) | `@/features/workspace-chat/model/contexts/ExecutionProcessesContext` | `features -> features` | A5 | Moved `WorkspacesLayout.tsx` from `features/workspace/ui/` to `pages/workspaces/`, updated import in `Workspaces.tsx` | claude | Page-level layout orchestrating providers from multiple features; same pattern as VSCodeWorkspacePage; 1 violation eliminated |
| DONE | `src/hooks/index.ts` | `4` | legacy (hooks) | `@/features/workspace/model/hooks/useTaskAttempt` | `legacy -> features` | A2 | Moved `useTaskAttempt` to `src/shared/hooks/useTaskAttempt.ts`, deleted old file, repointed 1 direct consumer (`GitActionsDialog.tsx`), removed unused barrel re-export | claude | Pure react-query hook; zero feature deps; no barrel consumers; 1 violation eliminated |
| DONE | `src/hooks/index.ts` | `7` | legacy (hooks) | `@/features/workspace/model/hooks/useRebase` | `legacy -> features` | A2 | Moved `useRebase` to `src/shared/hooks/useRebase.ts`, deleted old file, repointed `useGitOperations.ts`, removed unused barrel re-export | claude | Pure mutation hook; deps all shared-level (`@/lib/api`, `@/shared/hooks/useRepoBranches`); 2 violations eliminated |
| DONE | `src/hooks/index.ts` | `7-11` + `useGitOperations.ts` | legacy (hooks) | `useChangeTargetBranch`, `useRenameBranch`, `useMerge`, `usePush`, `useAttemptConflicts`, `useForcePush` from `@/features/workspace` | `legacy -> features` | A2 | Batch-moved 6 git mutation hooks to `src/shared/hooks/`, repointed `useGitOperations.ts` + `GitPanelContainer` + `ForcePushDialog` + `EditBranchNameDialog`, removed 5 unused barrel re-exports | claude | All pure mutation hooks with shared-level deps only (`@/lib/api`, `shared/types`, `@/shared/hooks/useRepoBranches`); 9 violations eliminated |
| DONE | `src/hooks/index.ts` | `10,11` | legacy (hooks) | `@/features/workspace/model/hooks/useRepoBranchSelection` | `legacy -> features` | A2 | Moved `useRepoBranchSelection` to `src/shared/hooks/useRepoBranchSelection.ts`, repointed 1 barrel consumer (`RepoBranchSelector.tsx`), removed 2 barrel re-exports | claude | Pure hook; deps all shared-level (`react-query`, `@/lib/api`, `@/shared/hooks/useRepoBranches`); 2 violations eliminated |
| DONE | `src/hooks/index.ts` | `10` | legacy (hooks) | `@/features/workspace/model/hooks/useTaskAttempts` | `legacy -> features` | A2 | Moved `useTaskAttempts` to `src/shared/hooks/useTaskAttempts.ts`, deleted old file, removed unused barrel re-export | claude | Pure react-query hook; zero feature deps; no barrel consumers; 1 violation eliminated |
| DONE | `src/hooks/useConversationHistory/index.ts` | `2,9` + `shared/lib/aggregateEntries.ts:1` | legacy (hooks) + shared | `types` + `useConversationHistoryOld` from `@/features/workspace-chat` | `legacy -> features`, `shared -> features` | A2 | Moved `useConversationHistory/` directory (types, constants, useConversationHistoryOld) to `src/shared/hooks/useConversationHistory/`, deleted legacy shim, repointed 6 consumers, removed stale re-exports from feature file | claude | Pure types + hook; all deps shared-level; also fixed transitive relative imports in features; 3 violations eliminated |
| DONE | `src/shared/hooks/useCreateModeState.ts` | `17` | shared | `@/integrations/electric/hooks` | `shared -> integrations` | A3 | Extracted `CreateModeInitialState` + `LinkedIssue` types to `src/shared/types/createMode.ts`, moved `useCreateModeState.ts` from `shared/hooks/` to legacy `hooks/` (can import integrations), repointed 3 consumers | claude | Shared layer cannot import integrations; hook uses `useShape` from Electric; types extracted to shared for cross-layer access; 1 violation eliminated; **ZERO violations remaining** |
| DONE | `src/app/entry/App.tsx` | `4` | app | `@/contexts/ClickedElementsProvider` | `app -> legacy (contexts)` | A5 | Moved `ClickedElementsProvider.tsx` from `contexts/` to `app/providers/`, repointed `@/utils/previewBridge` → `@/shared/lib/previewBridge` inside it, updated import in `App.tsx` | claude | App-level orchestration provider (wraps entire router); only 1 consumer; also fixed transitive legacy dep on `@/utils/previewBridge`; 2 violations eliminated |
| DONE | `src/app/entry/Bootstrap.tsx` | `15` | app | `@/types/modals` | `app -> legacy (types)` | A2 | Moved `modals.ts` from `types/` to `shared/types/`, repointed 1 consumer | claude | Pure type augmentation for NiceModal; all deps shared-level; 1 violation eliminated |
| DONE | `src/app/providers/ConfigProvider.tsx` | `10,12` | app | `@/lib/api`, `@/lib/remoteApi` | `app -> legacy (lib)` | A2 | Moved `api.ts` and `remoteApi.ts` from `lib/` to `shared/lib/`, batch-updated 82 consumers (including 2 with `.ts` extension and 1 relative import) | claude | Pure API modules; all deps shared-level; 67 violations eliminated |
| DONE | `src/components/NormalizedConversation/PendingApprovalEntry.tsx` | `23` | legacy (components) | `@/contexts/TabNavigationContext` | `components -> contexts` (cross-legacy) | A2 | Moved `TabNavigationContext.tsx` from `contexts/` to `shared/hooks/`, repointed 1 consumer. Also refined ESLint legacy-to-legacy rule to allow intra-directory imports (per-directory overrides) | claude | Pure context; only shared-level deps; rule refinement eliminated 30 false-positive intra-directory violations; 1 cross-legacy violation eliminated |
| DONE | `src/components/NormalizedConversation/RetryEditorInline.tsx` | `14` | legacy (components) | `@/hooks/useVariant` | `components -> hooks` (cross-legacy) | A2 | Moved `useVariant.ts` from `hooks/` to `shared/hooks/`, repointed 1 consumer, removed unused barrel re-export | claude | Pure React hook; zero external deps (only `react`); 1 violation eliminated |
| DONE | `src/components/tasks/TaskDetails/ProcessLogsViewer.tsx` | `4` | legacy (components) | `@/hooks/useLogStream` | `components -> hooks` (cross-legacy) | A2 | Moved `useLogStream.ts` from `hooks/` to `shared/hooks/`, repointed 7 consumers | claude | Pure WebSocket hook; deps only `react` + `shared/types`; 3 violations eliminated |
| DONE | `src/components/tasks/Toolbar/GitOperations.tsx` | `27` | legacy (components) | `@/hooks/useGitOperations` | `components -> hooks` (cross-legacy) | A2 | Moved `useGitOperations.ts` from `hooks/` to `shared/hooks/`, also moved `GitOperationsContext.tsx` from `contexts/` to `shared/hooks/` (prerequisite), repointed 5 consumers, removed unused barrel re-export | claude | Cascading A2: GitOperationsContext was only dep blocking shared placement; both modules pure with shared-level deps only; 2 violations eliminated |
| DONE | `src/components/ui/wysiwyg.tsx` | `67` | legacy (components) | `@/contexts/PortalContainerContext` | `components -> contexts` (cross-legacy) | A2 | Moved `PortalContainerContext.tsx` from `contexts/` to `shared/hooks/`, repointed 7 consumers | claude | Pure context; zero external deps (only `react`); 1 violation eliminated |
| DONE | `src/components/ui/wysiwyg.tsx` | `68` | legacy (components) | `@/contexts/WorkspaceContext` | `components -> contexts` (cross-legacy) | A3 | Split `WorkspaceContext` + `useWorkspaceContext` + `WorkspaceContextValue` + `NormalizedGitHubComment` to `shared/hooks/useWorkspaceContext.ts`, kept `WorkspaceProvider` in `contexts/`, repointed 38 consumers, also fixed `NormalizedGitHubComment` type to be shared-canonical | claude | Provider has legacy deps (hooks/useGitHubComments, hooks/useDiffStream, lib/routes); context+hook+types are pure shared; 11 violations eliminated |
| DONE | `src/components/ui/wysiwyg.tsx` | `69` | legacy (components) | `@/hooks/useExecutorDiscovery` | `components -> hooks` (cross-legacy) | A2 | Moved `useExecutorDiscovery.ts` to `shared/hooks/`, also moved prerequisite `useJsonPatchWsStream.ts` to `shared/hooks/` (pure WebSocket hook, only shared deps), repointed 5 consumers total | claude | Cascading A2: useJsonPatchWsStream had zero legacy deps; useExecutorDiscovery's only legacy dep was useJsonPatchWsStream; 3 violations eliminated |
| DONE | `src/contexts/ActionsContext.tsx` | `14` | legacy (contexts) | `@/lib/routes/projectSidebarRoutes` | `contexts -> lib` (cross-legacy) | A1 | Repointed 3 consumers from `@/lib/routes/projectSidebarRoutes` to existing `@/shared/lib/routes/projectSidebarRoutes`; also repointed 3 consumers from `@/lib/routes/navigation` to `@/shared/lib/routes/navigation` (same re-export shim pattern) | claude | Both legacy `lib/routes/` files were pure re-export shims of shared modules; 4 violations eliminated |
| DONE | `src/contexts/ActionsContext.tsx` | `15` | legacy (contexts) | `@/components/ui-new/actions` | `contexts -> components` (cross-legacy) | A3 | Extracted action types, enum, and pure helpers to `shared/types/actions.ts`; updated ActionsContext + 18 consumers to import types/helpers from shared; runtime `Actions` object stays in `components/ui-new/actions` | claude | A3 split: types/enum/helpers to shared, implementations stay in components; 4 violations eliminated (87→83) |
| DONE | `src/contexts/CreateModeContext.tsx` | `4` | legacy (contexts) | `@/hooks/useCreateModeState` | `contexts -> hooks` (cross-legacy) | A2 | Cascading A2: moved `useDebouncedCallback` (pure, zero deps) and `useScratch` (pure, only shared deps) to `shared/hooks/`, then moved `useCreateModeState` to `shared/hooks/`; repointed 8 consumers total | claude | Cascading A2: both prerequisites were pure; 4 violations eliminated (83→79) |
| DONE | `src/contexts/LogsPanelContext.tsx` | `10` | legacy (contexts) | `@/components/ui-new/containers/LogsContentContainer` | `contexts -> components` (cross-legacy) | A1 | Repointed `type LogsPanelContent` import to `@/shared/types/actions` where it was already extracted | claude | A1 repoint: type already existed in shared/types/actions; 1 violation eliminated (79→78) |
| DONE | `src/contexts/WorkspaceContext.tsx` | `9-10` | legacy (contexts) | `@/hooks/useGitHubComments`, `@/hooks/useDiffStream` | `contexts -> hooks` (cross-legacy) | A2 | Cascading A2: moved `usePrComments` (pure, prerequisite for useGitHubComments), then `useGitHubComments` and `useDiffStream` to `shared/hooks/`; repointed 4 consumers total | claude | All 3 hooks pure; usePrComments was prerequisite; 2 violations eliminated (78→76) |
| DONE | `src/contexts/remote/OrgContext.tsx` | `23` | legacy (contexts) | `@/hooks/organizationKeys` | `contexts -> hooks` (cross-legacy) | A2 | Moved `organizationKeys.ts` (pure constants, zero deps) to `shared/hooks/`; repointed 7 consumers (2 absolute + 4 relative + 1 dynamic import) | claude | Pure constants file; 1 violation eliminated (76→75) |
| DONE | `src/contexts/remote/UserContext.tsx` | `6` | legacy (contexts) | `@/hooks/auth/useAuth` | `contexts -> hooks` (cross-legacy) | A2 | Moved `useAuth.ts` (pure, only `@/shared/hooks/useUserSystem` dep) to `shared/hooks/auth/`; repointed 16 consumers (13 direct + 3 barrel) | claude | Pure hook; 4 violations eliminated (75→71) |
| DONE | `src/features/command-bar/ui/actions/pages.ts` | `3` | feature | `@/components/ui-new/actions` | `features -> components` (cross-legacy) | A3 | Extracted command bar types (`PageId`, `ResolvedGroup`, etc.) to `shared/types/commandBar.ts`; repointed 6 shared consumers to import types from shared; `Actions` runtime import in pages.ts remains (cannot be extracted) | claude | A3 split: types to shared, runtime stays; original violation persists but types are now properly layered; 0 net violations eliminated (71→71) |
| DONE | `src/features/kanban/ui/KanbanContainer.tsx` | `3,4,6` | feature | `@/contexts/remote/ProjectContext`, `@/contexts/remote/OrgContext`, `@/contexts/ActionsContext` | `features -> contexts` (cross-legacy) | A3 | Split consumer hooks (`useProjectContext`, `useOrgContext`, `useActions`) + types + context objects to `shared/hooks/`; kept Providers in `contexts/`; also moved `MutationResult`/`InsertResult` types to `shared/lib/electric/types.ts`; repointed 7 feature/shared consumers | claude | A3 split: hooks+types+context to shared, Providers stay in contexts; 5 violations eliminated (71→66) |
| DONE | `src/features/kanban/ui/ProjectKanban.tsx` | `10` | feature | `@/hooks/usePageTitle` | `features -> hooks` (cross-legacy) | A2 | Moved `usePageTitle.ts` (pure, zero deps) to `shared/hooks/`; repointed 3 consumers | claude | Pure React hook; 3 violations eliminated (66→63) |
| DONE | `src/features/kanban/ui/ProjectKanban.tsx` | `18` | feature | `@/hooks/useUserOrganizations` | `features -> hooks` (cross-legacy) | A2 | Moved `useUserOrganizations.ts` (pure, all shared-level deps) to `shared/hooks/`; repointed 9 consumers, updated barrel re-export | claude | Pure react-query hook; 3 violations eliminated (63→60) |
| DONE | (batch) `useConversationHistory.ts:13`, `useResetProcess.ts:5`, `ConversationListContainer.tsx:39` | `13,5,39` | features + shared | `@/utils/streamJsonPatchEntries`, `@/constants/processes`, `@/types/attempt` | `features/shared -> legacy` (cross-legacy) | A1 | Repointed 9 consumers from 3 legacy re-export shims to their existing shared targets (`@/shared/lib/streamJsonPatchEntries`, `@/shared/constants/processes`, `@/shared/types/attempt`) | claude | All 3 legacy files are pure re-export shims; import path change only; 7 violations eliminated (60→53) |
| DONE | (batch) `usePreviewDevServer.ts:5`, `useDevServer.ts:5`, `useAttemptExecution.ts:6`, etc. | various | features + shared + hooks | `@/lib/devServerUtils`, `@/lib/types`, `@/utils/executor`, `@/utils/scriptPlaceholders` | `features/shared/hooks -> legacy` | A1 | Repointed 9 consumers from 4 legacy re-export shims to shared targets (`@/shared/lib/devServerUtils`, `@/shared/lib/types`, `@/shared/lib/executor`, `@/shared/lib/scriptPlaceholders`) | claude | All 4 legacy files are pure re-export shims; import path change only; 6 violations eliminated (53→47) |
| DONE | `src/features/workspace-chat/ui/SessionChatBoxContainer.tsx` | `24` | feature | `@/hooks/useExecutorConfig` | `features -> hooks` (cross-legacy) | A2 | Cascading A2: moved `usePresetOptions` (pure, shared-level deps) then `useExecutorConfig` (pure, all shared-level deps after prereq) to `shared/hooks/`; repointed 3 consumers | claude | Both hooks pure; usePresetOptions was prerequisite; 1 violation eliminated (47→46) |
| DONE | (batch) `__root.tsx:9,10`, `VSCodeWorkspacePage.tsx:7`, `SessionChatBoxContainer.tsx:20`, `diffDataAdapter.ts:10` | various | routes + pages + features + shared | `@/hooks/usePreviousPath`, `@/hooks/useUiPreferencesScratch`, `@/utils/StyleOverride`, `@/contexts/ReviewProvider` | various cross-legacy | A2+A3 | Moved `usePreviousPath` and `useUiPreferencesScratch` to `shared/hooks/`; moved `useStyleOverrideThemeSetter` to `shared/lib/StyleOverride`; A3-split `TerminalContext` (hook+types to `shared/hooks/useTerminal.ts`, Provider stays); A3-split `ReviewProvider` (hooks+types to `shared/hooks/useReview.ts`, Provider stays); repointed 9 consumers | claude | 5 violations eliminated (46→41) |
| DONE | (batch) `ElectricTestPage.tsx:3`, `fileTreeUtils.ts:2`, `useCreateModeState.ts:17` | various | pages + shared | `@/hooks` barrel, `@/components/ui-new/types/fileTree`, `@/integrations/electric/hooks` | pages->legacy, shared->components, shared->integrations | A1+A2 | Moved `useCurrentUser` to `shared/hooks/auth/`; repointed ElectricTestPage to direct shared imports; moved `fileTree.ts` types to `shared/types/`; moved `useCreateModeState` back to `hooks/` (shared can't import integrations) | claude | Net 2 violations eliminated (41→39); useCreateModeState swap: removed shared→integrations, added contexts→hooks |
| DONE | (batch) `useActionVisibilityContext.ts:18`, `NewDisplayConversationEntry.tsx:27,28`, `electric/hooks.ts:4`, `ActionsContext.tsx:26` | various | hooks + features + integrations + contexts | `@/contexts/LogsPanelContext`, `@/contexts/ChangesViewContext`, `@/contexts/SyncErrorContext` | cross-legacy | A3 | A3-split 3 contexts: extracted `useLogsPanel` to `shared/hooks/useLogsPanel.ts`, `useChangesView` to `shared/hooks/useChangesView.ts`, `useSyncErrorContext` to `shared/hooks/useSyncErrorContext.ts`; kept Providers in `contexts/`; repointed 4 consumers | claude | 4 violations eliminated (39→35) |
| DONE | `src/contexts/CreateModeContext.tsx` | `4` | legacy (contexts) | `@/hooks/useCreateModeState` | `contexts -> hooks` (cross-legacy) | A2 | Moved `useCreateModeState.ts` from `hooks/` to `contexts/` (same directory as its sole consumer); updated import to `@/contexts/useCreateModeState` | claude | Intra-directory import allowed; 1 violation eliminated (35→34) |
| DONE | (batch) `pages.ts:1`, `KanbanContainer.tsx:27`, `SessionChatBoxContainer.tsx:50`, `useIssueShortcuts.ts:5`, `useWorkspaceShortcuts.ts:5` | various | features + keyboard | `@/components/ui-new/actions` | features/keyboard -> components | A2 | Extracted `getIdeName` to `shared/lib/ideName.ts`; moved `Actions` + navbar/context groups to `shared/actions/index.ts`; left re-export shim at old path; repointed 5 violation consumers | claude | Only non-shared dep was `getIdeName` (pure fn); 5 violations eliminated (34→29) |
| DONE | (batch) `useIssueShortcuts.ts:4`, `useWorkspaceShortcuts.ts:3`, `SessionChatBoxContainer.tsx:59`, `ProjectKanban.tsx:19` | various | keyboard + features | `@/contexts/ActionsContext`, `@/hooks/useActionVisibilityContext`, `@/hooks/useOrganizationProjects` | cross-legacy + features->hooks | A1+A2 | Repointed keyboard files from `@/contexts/ActionsContext` to `@/shared/hooks/useActions`; moved `useActionVisibilityContext` to `integrations/` (has Electric dep); moved `useOrganizationProjects` to `integrations/` (has Electric dep); repointed 6 consumers | claude | Hooks with `@/integrations/electric` dep go to `integrations/` layer; 4 violations eliminated (29→25) |
| DONE | (batch) `_app.tsx:3`, `vscode.tsx:3`, `LandingPage.tsx:37,38`, `SessionChatBoxContainer.tsx:11` | various | routes + features | `@/contexts/TerminalContext`, `@/components/agents/AgentIcon`, `@/components/ide/IdeIcon` | routes/features -> legacy | A2+A5 | Moved `TerminalProvider` to `app/providers/`; moved `AgentIcon` and `IdeIcon` to `shared/components/`; left re-export shims at old paths; repointed 5 violation consumers | claude | All 3 components had pure shared-level deps; 5 violations eliminated (25→20) |
| DONE | `src/features/kanban/ui/KanbanContainer.tsx` | `56` | feature | `@/components/ui-new/containers/SearchableTagDropdownContainer` | `features -> components` (cross-legacy) | A2 | Moved `SearchableTagDropdownContainer` to `shared/components/`, left re-export shim at old path, repointed 1 violation consumer | claude | Pure component; deps only react, react-virtuoso, shared/remote-types, @vibe/ui; 1 violation eliminated (20→19) |
| DONE | `src/features/kanban/ui/ProjectKanban.tsx` | `5,7` | feature | `@/contexts/remote/OrgContext` (OrgProvider), `@/contexts/remote/ProjectContext` (ProjectProvider) | `features -> contexts` (cross-legacy) | A2 | Moved `OrgProvider` and `ProjectProvider` to `integrations/remote/`, left re-export shims at old paths, repointed 1 violation consumer | claude | Both Providers depend on `@/integrations/electric/hooks` (useShape); features can import integrations; 3 violations eliminated (19→16) |
| DONE | `src/pages/workspaces/WorkspacesLayout.tsx` | `8,9,10` | page | `@/contexts/CreateModeContext` (CreateModeProvider), `@/contexts/ReviewProvider`, `@/contexts/ChangesViewContext` (ChangesViewProvider) | `pages -> contexts` (cross-legacy) | A2+A3 | A3-split CreateModeContext: extracted `useCreateMode` hook+context to `shared/hooks/useCreateMode.ts`, moved Provider to `integrations/CreateModeProvider.tsx`, moved `useCreateModeState` to `integrations/`; A3-split UserContext (prerequisite): hook+types to `shared/hooks/useUserContext.ts`, Provider to `integrations/remote/UserProvider.tsx`; A2-moved `ReviewProvider` to `shared/hooks/` (pure, all shared deps); A2-moved `ChangesViewProvider` to `shared/hooks/` (pure, all shared deps); left re-export shims at old paths | claude | CreateModeProvider depends on `useCreateModeState` which uses `useShape` from Electric → integrations layer; 3 violations eliminated (16→13) |
| DONE | `src/features/kanban/ui/ProjectKanban.tsx` | `12` | feature | `@/components/ui-new/containers/ProjectRightSidebarContainer` | `features -> components` (cross-legacy) | A5 | Moved `ProjectKanban.tsx` and `ProjectRightSidebarContainer.tsx` to `pages/kanban/`, updated 6 route file imports | claude | Page-level cross-feature orchestration; -1 original violation, +2 new legacy container violations in pages; net 14→14 then 14→14 |
| DONE | `src/features/workspace-chat/ui/NewDisplayConversationEntry.tsx` | `23` | feature | `@/components/ui/wysiwyg` (WYSIWYGEditor) | `features -> components` (cross-legacy) | A2 | Extracted `writeClipboardViaBridge`+`parentClipboardWrite` to `shared/lib/clipboard.ts`, moved `wysiwyg.tsx` to `shared/components/WYSIWYGEditor.tsx`, repointed 12 consumers, updated `bridge.ts` and `ContextMenu.tsx` | claude | 600+ line cross-cutting WYSIWYG editor used by 12 files; only non-shared dep was clipboard utility (pure postMessage); 2 violations eliminated (14→12) |
| DONE | `src/features/workspace-chat/ui/NewDisplayConversationEntry.tsx` | `24` | feature | `@/components/NormalizedConversation/DisplayConversationEntry` | `features -> components` (cross-legacy) | A2 | Cascading A2: moved `VariantSelector` to `shared/components/` (pure, 1 consumer), moved `RawLogText` to `shared/components/` (pure, 3 consumers), moved entire `NormalizedConversation/` dir (7 files) to `shared/components/NormalizedConversation/`, repointed 5 consumers | claude | All deps shared-level once VariantSelector moved; 1 violation eliminated (12→11) |
| DONE | `src/features/workspace-chat/ui/SessionChatBoxContainer.tsx` | `43` | feature | `@/components/ui-new/containers/ModelSelectorContainer` | `features -> components` (cross-legacy) | A2 | Moved `ModelSelectorContainer` to `shared/components/`, repointed 2 consumers (`SessionChatBoxContainer`, `CreateChatBoxContainer`) | claude | Pure component; all deps shared-level (shared/lib, shared/hooks, @vibe/ui); 1 violation eliminated (11→10) |
| DONE | `src/pages/kanban/ProjectRightSidebarContainer.tsx` | `24` | page | `@/components/ui-new/containers/CreateChatBoxContainer` | `pages -> components` (cross-legacy) | A2 | Cascading A2: moved `useCreateWorkspace` and `useCreateAttachments` to `shared/hooks/` (pure, all shared deps), moved `CreateModeRepoPickerBar` and `CreateChatBoxContainer` to `shared/components/`, repointed 2 page consumers | claude | All deps shared-level once prereq hooks moved; 2 violations eliminated (10→8) |
| DONE | `src/pages/kanban/ProjectRightSidebarContainer.tsx` | `25` | page | `@/components/ui-new/containers/KanbanIssuePanelContainer` | `pages -> components` (cross-legacy) | A5+A3+A2 | A3-split IssueContext (hook+types to shared, Provider to integrations), moved useProjectWorkspaceCreateDraft and useAzureAttachments to shared/hooks, moved KanbanIssuePanelContainer + 4 section containers + state module to pages/kanban/ | claude | Page-specific component family (only consumed by ProjectRightSidebarContainer); cascading: A3 IssueContext, A2 prereq hooks; 1 violation eliminated (8→7) |
| DONE | `src/pages/workspaces/VSCodeWorkspacePage.tsx` | `12` | page | `@/components/ui-new/containers/ConversationListContainer` | `pages -> components` (cross-legacy) | A1 | Repointed import to canonical `@/features/workspace-chat/ui/ConversationListContainer`, deleted stale duplicate in `components/ui-new/containers/` | claude | Stale copy existed alongside canonical features/ version; import path change + cleanup; 1 violation eliminated (7→6) |
| DONE | `src/pages/workspaces/WorkspacesLayout.tsx` | `11` | page | `@/components/ui-new/containers/WorkspacesSidebarContainer` | `pages -> components` (cross-legacy) | A5+A2 | Moved `useAllOrganizationProjects` to `shared/hooks/` (pure, all shared deps), moved `WorkspacesSidebarContainer` to `pages/workspaces/` (single consumer) | claude | Page-specific sidebar; only 1 legacy dep (hook) which was pure; 1 violation eliminated (6→5) |
| DONE | `src/pages/workspaces/WorkspacesLayout.tsx` | `12` | page | `@/components/ui-new/containers/LogsContentContainer` | `pages -> components` (cross-legacy) | A5+A2 | Cascading A2: moved `XTermInstance`, `VirtualizedProcessLogs`, `TerminalPanelContainer` to `shared/components/` (all pure), moved `LogsContentContainer` to `pages/workspaces/`, repointed 4 consumers | claude | All deps pure shared-level once prerequisites moved; 1 violation eliminated (5→4) |
| DONE | `src/pages/workspaces/WorkspacesLayout.tsx` | `13` | page | `@/components/ui-new/containers/WorkspacesMainContainer` | `pages -> components` (cross-legacy) | A5+A2 | Moved `useContextBarPosition` to `shared/hooks/`, `CopyButton` to `shared/components/`, `ContextBarContainer` to `pages/workspaces/` (has integrations dep), `WorkspacesMainContainer` to `pages/workspaces/` | claude | ContextBarContainer imports from integrations layer so can't be in shared; placed in pages alongside its single consumer; 1 violation eliminated (4→3) |
| DONE | `src/pages/workspaces/WorkspacesLayout.tsx` | `17` | page | `@/components/ui-new/containers/RightSidebar` | `pages -> components` (cross-legacy) | A5 | Moved RightSidebar + 5 child containers (FileTreeContainer, ProcessListContainer, PreviewControlsContainer, GitPanelContainer, WorkspaceNotesContainer) to `pages/workspaces/` with relative imports | claude | All 5 children had zero legacy deps and single consumer (RightSidebar); RightSidebar single consumer (WorkspacesLayout); 1 violation eliminated (3→2) |
| DONE | `src/pages/workspaces/WorkspacesLayout.tsx` | `18` | page | `@/components/ui-new/containers/ChangesPanelContainer` | `pages -> components` (cross-legacy) | A5+A2 | Cascading A2: moved `useOpenInEditor`, `OpenInIdeButton`, `useScrollSyncStateMachine` to shared (all pure). A5: moved PierreDiffCard + 3 siblings (ReviewCommentRenderer, GitHubCommentRenderer, CommentWidgetLine) + ChangesPanelContainer to `pages/workspaces/` | claude | PierreDiffCard had 2 legacy deps (both pure), 3 pure siblings; all single-consumer chain; 1 violation eliminated (2→1) |
| DONE | `src/pages/workspaces/WorkspacesLayout.tsx` | `20` | page | `@/components/ui-new/containers/PreviewBrowserContainer` | `pages -> components` (cross-legacy) | A5+A2 | Cascading A2: moved `usePreviewUrl`, `usePreviewSettings`, `usePreviewNavigation` to `shared/hooks/` (all pure). A5: moved `PreviewBrowserContainer` to `pages/workspaces/` | claude | All 3 hooks pure with shared-level deps; single consumer; **ZERO violations remaining**; 1 violation eliminated (1→0) |

## Example Entry

| Status | File | Line | Importer Layer | Imported Module | Violation Type | Decision (A1-A5) | Action Summary | Owner | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| DONE | `src/features/command-bar/ui/actions/useActionVisibility.ts` | `8` | feature | `@/features/workspace-chat/model/store/useDiffViewStore` | `features -> features` | A2 | Move `useDiffViewStore` to `src/shared/stores` and repoint imports |  | Cross-cutting UI state |

## Definition Of Done (Per Issue)

- The targeted issue is resolved in `pnpm run local-web:lint`.
- No new boundary violations introduced.
- Imports point to owning layer (not convenience aliases).
- Behavior unchanged (run relevant checks/tests).
